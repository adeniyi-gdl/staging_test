# HTTP server - handles staging traffic
server {
    listen 80;
    server_name api-test.housemoni.org;

    # For now, keep HTTP active in staging (no redirect)
    # If you want to force HTTPS later, uncomment this line:
    # return 301 https://$host$request_uri;

    # Proxy routes
    location /user-service/ {
        proxy_pass http://user-service:3080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /account-service/ {
        proxy_pass http://account-service:3077/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /dms-service/ {
        proxy_pass http://dms-service:3073/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /hpa-service/ {
        proxy_pass http://hpa-service:3090/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /gdl-website/ {
        proxy_pass http://gdl-website:3013/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /saveinvest-service/ {
        proxy_pass http://saveinvest-service:3078/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /bankone-service/ {
        proxy_pass http://bankone-service:3047/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /notification-service/ {
        proxy_pass http://notification-service:3079/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /loan-service/ {
        proxy_pass http://loan-service:3081/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /symplus-service/ {
        proxy_pass http://symplus-service:3011/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /transaction-service/ {
        proxy_pass http://transaction-service:3075/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Default fallback
    location / {
        return 404;
    }
}

# Optional HTTPS server - enable only if certs are mounted
# server {
#     listen 443 ssl;
#     server_name api-test.housemoni.org;
#
#     ssl_certificate /etc/letsencrypt/live/api-test.housemoni.org/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/api-test.housemoni.org/privkey.pem;
#
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#
#     include /etc/nginx/conf.d/default.conf;
# }
